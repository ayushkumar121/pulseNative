<?xml version="1.0" encoding="UTF-8"?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms" 
             xmlns:forms="clr-namespace:Lottie.Forms;assembly=Lottie.Forms" 
             xmlns:android="clr-namespace:Xamarin.Forms.PlatformConfiguration.AndroidSpecific;assembly=Xamarin.Forms.Core"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml" NavigationPage.HasNavigationBar="False" x:Class="pulse.EventsPage">
    <ContentPage.Content>
        <AbsoluteLayout Margin="0,10,0,10">
            
            <StackLayout AbsoluteLayout.LayoutFlags="All" AbsoluteLayout.LayoutBounds="0,0,1,1">
                <Grid Margin="0,35,0,0" >
                    <Grid.ColumnDefinitions>
                          <ColumnDefinition Width="*" />
                          <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    
                    <Frame BackgroundColor="Transparent" HeightRequest="50" Padding="5,10,5,5" Grid.Column="0" HasShadow="false">
                        <StackLayout>
                            <Label FontSize="Large" Text="Departments" FontAttributes="Bold" />
                            <BoxView x:Name="DeptActiveLine" IsVisible="true" BackgroundColor="{StaticResource AccentColor}" HeightRequest="3"/>            
                        </StackLayout>
                        
                        <Frame.GestureRecognizers>
                              <TapGestureRecognizer
                                    Tapped="OnTapDepartment"/>
                        </Frame.GestureRecognizers>
                    </Frame>
                    
                    <Frame BackgroundColor="Transparent" HeightRequest="50" Padding="5,10,5,5" Grid.Column="1" HasShadow="false">
                        <StackLayout>
                            <Label FontSize="Large" Text="Schedule" FontAttributes="Bold" />
                            <BoxView x:Name="SchActiveLine" IsVisible="false" BackgroundColor="{StaticResource AccentColor}" HeightRequest="3"/>         
                        </StackLayout>
                        
                        <Frame.GestureRecognizers>
                                <TapGestureRecognizer
                                    Tapped="OnTapSchedule"/>
                        </Frame.GestureRecognizers>  
                    </Frame>
                </Grid>
                
                <Frame x:Name="DepartmentCard" Padding="5" Margin="0,5,0,0">
                    <ScrollView>
                    <Grid>
                        <Grid.ColumnDefinitions>
                              <ColumnDefinition Width="*" />
                              <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                            
                        <ImageButton Grid.Column="0" Grid.Row="0" 
                               Source="pulse_tabs_05" 
                               HeightRequest="200" 
                               CommandParameter="0"
                               Command="{Binding OpenEventPage}"      
                               />
                        
                        <ImageButton Grid.Column="1" Grid.Row="0" 
                               Source="pulse_tabs_02" 
                               HeightRequest="200" 
                               CommandParameter="1"
                               Command="{Binding OpenEventPage}"    
                               />
                        
                        <ImageButton Grid.Column="0" Grid.Row="1" 
                               Source="pulse_tabs_03" 
                               HeightRequest="200" 
                               CommandParameter="2"
                               Command="{Binding OpenEventPage}"    
                               />
                        
                        <ImageButton Grid.Column="1" Grid.Row="1" 
                               Source="pulse_tabs_06" 
                               HeightRequest="200"  
                               CommandParameter="3"
                               Command="{Binding OpenEventPage}"    
                               />
                        
                        <ImageButton Grid.Column="0" Grid.Row="2" 
                               BackgroundColor="#eee" 
                               Source="pulse_tabs_01" 
                               HeightRequest="200"  
                               CommandParameter="4"
                               Command="{Binding OpenEventPage}"    
                               />
                        
                        <ImageButton Grid.Column="1" Grid.Row="2" 
                               Source="pulse_tabs_04" 
                               HeightRequest="200"
                               CommandParameter="5"
                               Command="{Binding OpenEventPage}"    
                               />
                    </Grid> 
                    </ScrollView>
                </Frame>
                
                <Frame IsVisible="false" Margin="0,5,0,0" x:Name="ScheduleCard">
                    <StackLayout>
                    <ListView SelectionMode="None" Margin="0,35,0,0" 
                          SeparatorColor="Transparent" 
                          HasUnevenRows="true" 
                          x:Name="listView" 
                          IsGroupingEnabled="true"
                          ItemTapped="Handle_ItemTapped"
                          ItemsSource="{Binding GroupedEvent}" >
                    <ListView.GroupHeaderTemplate>
                        <DataTemplate>
                            <ViewCell>
                                <Frame HasShadow="true" BackgroundColor="White">
                                    <StackLayout>
                                        <Label Text="{Binding Key}" FontSize="28" />
                                    </StackLayout>
                                </Frame>
                            </ViewCell>
                        </DataTemplate>
                    </ListView.GroupHeaderTemplate>
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <ViewCell>
                                <StackLayout HorizontalOptions="FillAndExpand" Orientation="Vertical">
                                    <Frame BackgroundColor="Transparent" HasShadow="false" Margin="5" Padding="15">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                          
                                            <Label Grid.Column="0" HorizontalOptions="Start" Text="{Binding name}" FontSize="Large" />
                                            <Label Grid.Column="3" HorizontalOptions="End" FontFamily="{StaticResource MaterialFontFamily}" 
                                                   FontSize="28" Text="{Binding status_icon}"/>                                    
                                        </Grid>
                                    </Frame>
                                </StackLayout>
                            </ViewCell>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
                </StackLayout>
                </Frame>
                
            </StackLayout>
    
            <Frame IsVisible="false"
                   Scale="0"
                   x:Name="DetailsCard"
                   AbsoluteLayout.LayoutFlags="WidthProportional,HeightProportional" 
                   BackgroundColor="White" 
                   Padding="0"
                   CornerRadius="2"
                   AbsoluteLayout.LayoutBounds="0,50,1,1">
                <StackLayout HorizontalOptions="FillAndExpand" VerticalOptions="FillAndExpand">
                    
                    <Label TextColor="#666" HorizontalOptions="Center" FontFamily="{StaticResource MaterialFontFamily}" FontSize="48" Text="close">
                        <Label.GestureRecognizers>
                            <TapGestureRecognizer Tapped="ClosePopUp" />
                        </Label.GestureRecognizers>
                    </Label>                                    
                    
                    <WebView HorizontalOptions="FillAndExpand" VerticalOptions="FillAndExpand" x:Name="webview" />
                </StackLayout>
            </Frame>
            
            <ActivityIndicator x:Name="Loading"
                               AbsoluteLayout.LayoutFlags="PositionProportional"  
                               AbsoluteLayout.LayoutBounds=".5,.5,50,50" />
            
            <ImageButton Source="refresh"
                x:Name="ReloadButton"
                BackgroundColor="Transparent"
                AbsoluteLayout.LayoutFlags="PositionProportional"  
                AbsoluteLayout.LayoutBounds="0.05,0,30,30" 
                Clicked="OnReloadButtonClicked" />
            
            <BoxView Color="{StaticResource AccentColor}" 
                     CornerRadius="8" 
                     AbsoluteLayout.LayoutFlags="PositionProportional" 
                     AbsoluteLayout.LayoutBounds=".5,0,30,30">
                <BoxView.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OpenPulsePage" />
                </BoxView.GestureRecognizers>
            </BoxView>

            
            <ImageButton BackgroundColor="Transparent" 
                         Clicked="Handle_Clicked" Source="pawprint"  
                         AbsoluteLayout.LayoutFlags="PositionProportional" 
                         AbsoluteLayout.LayoutBounds=".95,0,30,30"/>
        </AbsoluteLayout>
    </ContentPage.Content>
</ContentPage>